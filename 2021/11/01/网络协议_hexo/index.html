

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" href="/img/favicon.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  
    <meta name="description" content="网络基础之网络协议篇本文转自https:&#x2F;&#x2F;www.cnblogs.com&#x2F;linhaifeng&#x2F;articles&#x2F;5937962.html 一.操作系统基础 操作系统:(Operating System，简称OS)是管理和控制计算机硬件与软件资源的计算机程序，是直接运行在“裸机”上的最基本的系统软件，任何其他软件都必须在操作系统的支持下才能运行。 注：计算机(硬件)－&gt;os－&gt;应用软">
<meta property="og:type" content="article">
<meta property="og:title" content="网络协议（转）">
<meta property="og:url" content="http://example.com/2021/11/01/%E7%BD%91%E7%BB%9C%E5%8D%8F%E8%AE%AE_hexo/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="网络基础之网络协议篇本文转自https:&#x2F;&#x2F;www.cnblogs.com&#x2F;linhaifeng&#x2F;articles&#x2F;5937962.html 一.操作系统基础 操作系统:(Operating System，简称OS)是管理和控制计算机硬件与软件资源的计算机程序，是直接运行在“裸机”上的最基本的系统软件，任何其他软件都必须在操作系统的支持下才能运行。 注：计算机(硬件)－&gt;os－&gt;应用软">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008115246442-867569611.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008115341598-934171433.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008131010254-430615122.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008131301051-196580728.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008131410957-1579746437.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008145544426-736439132.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008144925254-1398507493.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20200415215541847-564448301.gif">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008154500754-704720294.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008164852129-1597186542.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008171118317-164674895.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008172732957-102296982.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008185553973-1895926477.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008185648160-191189690.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008190023098-992049015.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161013091647484-1707663286.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20200415222138157-249976328.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20200415220004538-1827984001.gif">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20201012174443242-1565501096.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20201012174541729-1246240693.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20201012174943786-1550814066.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20201012175307563-473595213.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/ContractedBlock.gif">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/ContractedBlock.gif">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20201012175158975-374415105.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20201012181341361-436742942.png">
<meta property="og:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/640.jpeg">
<meta property="article:published_time" content="2021-11-01T08:34:18.000Z">
<meta property="article:modified_time" content="2021-11-19T03:54:23.492Z">
<meta property="article:author" content="John Doe">
<meta property="article:tag" content="python">
<meta property="article:tag" content="python代码">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008115246442-867569611.png">
  
  
  <title>网络协议（转） - Hexo</title>

  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/github-markdown-css@4/github-markdown.min.css" />
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/hint.css@2/hint.min.css" />

  
    
    
      
      <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/highlight.js@10/styles/github-gist.min.css" />
    
  

  
    <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.css" />
  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    var CONFIG = {"hostname":"example.com","root":"/","version":"1.8.13","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"right","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"copy_btn":true,"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 6.0.0"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Fluid</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                Home
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                Archives
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                Categories
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                Tags
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              &nbsp;<i class="iconfont icon-search"></i>&nbsp;
            </a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner" id="banner" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="page-header text-center fade-in-up">
            <span class="h2" id="subtitle" title="网络协议（转）">
              
            </span>

            
              <div class="mt-3">
  
  
    <span class="post-meta">
      <i class="iconfont icon-date-fill" aria-hidden="true"></i>
      <time datetime="2021-11-01 16:34" pubdate>
        November 1, 2021 pm
      </time>
    </span>
  
</div>

<div class="mt-1">
  
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      12k 字
    </span>
  

  
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      97 分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">网络协议（转）</h1>
            
            <div class="markdown-body">
              <h1 id="网络基础之网络协议篇"><a href="#网络基础之网络协议篇" class="headerlink" title="网络基础之网络协议篇"></a>网络基础之网络协议篇</h1><p>本文转自<a target="_blank" rel="noopener" href="https://www.cnblogs.com/linhaifeng/articles/5937962.html">https://www.cnblogs.com/linhaifeng/articles/5937962.html</a></p>
<h1 id="一-操作系统基础"><a href="#一-操作系统基础" class="headerlink" title="一.操作系统基础"></a>一.操作系统基础</h1><p> 操作系统:(Operating System，简称OS)是管理和控制计算机硬件与软件资源的计算机程序，是直接运行在“裸机”上的最基本的系统软件，任何其他软件都必须在操作系统的支持下才能运行。</p>
<p>注：计算机(硬件)－&gt;os－&gt;应用软件</p>
<h1 id="二-网络通信原理"><a href="#二-网络通信原理" class="headerlink" title="二.网络通信原理"></a>二.网络通信原理</h1><h2 id="2-1-互联网的本质就是一系列的网络协议"><a href="#2-1-互联网的本质就是一系列的网络协议" class="headerlink" title="2.1 互联网的本质就是一系列的网络协议"></a>2.1 互联网的本质就是一系列的网络协议</h2><p>一台硬设有了操作系统，然后装上软件你就可以正常使用了，然而你也只能自己使用</p>
<p>像这样，每个人都拥有一台自己的机器，然而彼此孤立</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008115246442-867569611.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>如何能大家一起玩耍</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008115341598-934171433.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>然而internet为何物？</p>
<p>其实两台计算机之间通信与两个人打电话之间通信的原理是一样的（中国有很多地区，不同的地区有不同的方言，为了全中国人都可以听懂，大家统一讲普通话）</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008131010254-430615122.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>普通话属于中国国内人与人之间通信的标准，那如果是两个国家的人交流呢？</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008131301051-196580728.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>问题是，你不可能要求一个人／计算机掌握全世界的语言／标准，于是有了世界统一的通信标准：英语</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008131410957-1579746437.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>结论：英语成为世界上所有人通信的统一标准，如果把计算机看成分布于世界各地的人，那么连接两台计算机之间的internet实际上就是</p>
<p>一系列统一的标准，这些标准称之为互联网协议，互联网的本质就是一系列的协议，总称为‘互联网协议’（Internet Protocol Suite).</p>
<p>互联网协议的功能：定义计算机如何接入internet，以及接入internet的计算机通信的标准。</p>
<h2 id="2-2-osi七层协议"><a href="#2-2-osi七层协议" class="headerlink" title="2.2 osi七层协议"></a>2.2 osi七层协议</h2><p>互联网协议按照功能不同分为osi七层或tcp/ip五层或tcp/ip四层</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008145544426-736439132.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>每层运行常见物理设备</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008144925254-1398507493.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>OSI七层协议数据传输的封包与解包过程 </p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20200415215541847-564448301.gif" srcset="/img/loading.gif" lazyload alt="img"></p>
<h2 id="2-3-tcp-ip五层模型讲解"><a href="#2-3-tcp-ip五层模型讲解" class="headerlink" title="2.3 tcp/ip五层模型讲解"></a>2.3 tcp/ip五层模型讲解</h2><p>我们将应用层，表示层，会话层并作应用层，从tcp／ip五层协议的角度来阐述每层的由来与功能，搞清楚了每层的主要协议</p>
<p>就理解了整个互联网通信的原理。</p>
<p>首先，用户感知到的只是最上面一层应用层，自上而下每层都依赖于下一层，所以我们从最下一层开始切入，比较好理解</p>
<p>每层都运行特定的协议，越往上越靠近用户，越往下越靠近硬件</p>
<h3 id="2-3-1-物理层"><a href="#2-3-1-物理层" class="headerlink" title="2.3.1 物理层"></a>2.3.1 物理层</h3><p>物理层由来：上面提到，孤立的计算机之间要想一起玩，就必须接入internet，言外之意就是计算机之间必须完成组网</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008154500754-704720294.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>物理层功能：主要是基于电器特性发送高低电压(电信号)，高电压对应数字1，低电压对应数字0</p>
<h3 id="2-3-2-数据链路层"><a href="#2-3-2-数据链路层" class="headerlink" title="2.3.2 数据链路层"></a>2.3.2 数据链路层</h3><p>数据链路层由来：单纯的电信号0和1没有任何意义，必须规定电信号多少位一组，每组什么意思</p>
<p>数据链路层的功能：定义了电信号的分组方式</p>
<p><em><strong>以太网协议：</strong></em></p>
<p>早期的时候各个公司都有自己的分组方式，后来形成了统一的标准，即以太网协议ethernet</p>
<p>ethernet规定</p>
<ul>
<li>一组电信号构成一个数据包，叫做‘帧’</li>
<li>每一数据帧分成：报头head和数据data两部分</li>
</ul>
<table>
<thead>
<tr>
<th>head</th>
<th>data</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>head包含：(固定18个字节)</p>
<ul>
<li>发送者／源地址，6个字节</li>
<li>接收者／目标地址，6个字节</li>
<li>数据类型，6个字节</li>
</ul>
<p>data包含：(最短46字节，最长1500字节)</p>
<ul>
<li>数据包的具体内容</li>
</ul>
<p>head长度＋data长度＝最短64字节，最长1518字节，超过最大限制就分片发送</p>
<p><em><strong>mac地址：</strong></em></p>
<p>head中包含的源和目标地址由来：ethernet规定接入internet的设备都必须具备网卡，发送端和接收端的地址便是指网卡的地址，即mac地址</p>
<p>mac地址：每块网卡出厂时都被烧制上一个世界唯一的mac地址，长度为48位2进制，通常由12位16进制数表示（前六位是厂商编号，后六位是流水线号）</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008164852129-1597186542.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>*<strong>广播：*</strong></p>
<p>有了mac地址，同一网络内的两台主机就可以通信了（一台主机通过arp协议获取另外一台主机的mac地址）</p>
<p>ethernet采用最原始的方式，广播的方式进行通信，即计算机通信基本靠吼</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008171118317-164674895.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="2-3-3-网络层"><a href="#2-3-3-网络层" class="headerlink" title="2.3.3 网络层"></a>2.3.3 网络层</h3><p>网络层由来：有了ethernet、mac地址、广播的发送方式，世界上的计算机就可以彼此通信了，问题是世界范围的互联网是由</p>
<p>一个个彼此隔离的小的局域网组成的，那么如果所有的通信都采用以太网的广播方式，那么一台机器发送的包全世界都会收到，</p>
<p>这就不仅仅是效率低的问题了，这会是一种灾难</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008172732957-102296982.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>上图结论：必须找出一种方法来区分哪些计算机属于同一广播域，哪些不是，如果是就采用广播的方式发送，如果不是，</p>
<p>就采用路由的方式（向不同广播域／子网分发数据包），mac地址是无法区分的，它只跟厂商有关</p>
<p>网络层功能：引入一套新的地址用来区分不同的广播域／子网，这套地址即网络地址</p>
<p><em><strong>IP协议：</strong></em></p>
<ul>
<li>规定网络地址的协议叫ip协议，它定义的地址称之为ip地址，广泛采用的v4版本即ipv4，它规定网络地址由32位2进制表示</li>
<li>范围0.0.0.0-255.255.255.255</li>
<li>一个ip地址通常写成四段十进制数，例：172.16.10.1</li>
</ul>
<p>*<strong>ip地址分成两部分*</strong></p>
<ul>
<li>网络部分：标识子网</li>
<li>主机部分：标识主机</li>
</ul>
<p>注意：单纯的ip地址段只是标识了ip地址的种类，从网络部分或主机部分都无法辨识一个ip所处的子网</p>
<p>例：172.16.10.1与172.16.10.2并不能确定二者处于同一子网</p>
<p><em><strong>子网掩码</strong></em></p>
<p>所谓”子网掩码”，就是表示子网络特征的一个参数。它在形式上等同于IP地址，也是一个32位二进制数字，它的网络部分全部为1，主机部分全部为0。比如，IP地址172.16.10.1，如果已知网络部分是前24位，主机部分是后8位，那么子网络掩码就是11111111.11111111.11111111.00000000，写成十进制就是255.255.255.0。</p>
<p>知道”子网掩码”，我们就能判断，任意两个IP地址是否处在同一个子网络。方法是将两个IP地址与子网掩码分别进行AND运算（两个数位都为1，运算结果为1，否则为0），然后比较结果是否相同，如果是的话，就表明它们在同一个子网络中，否则就不是。</p>
<p>比如，已知IP地址172.16.10.1和172.16.10.2的子网掩码都是255.255.255.0，请问它们是否在同一个子网络？两者与子网掩码分别进行AND运算，</p>
<p>172.16.10.1：10101100.00010000.00001010.000000001</p>
<p>255255.255.255.0:11111111.11111111.11111111.00000000</p>
<p>AND运算得网络地址结果：10101100.00010000.00001010.000000001-&gt;172.16.10.0</p>
<p>172.16.10.2：10101100.00010000.00001010.000000010</p>
<p>255255.255.255.0:11111111.11111111.11111111.00000000</p>
<p>AND运算得网络地址结果：10101100.00010000.00001010.000000001-&gt;172.16.10.0</p>
<p>结果都是172.16.10.0，因此它们在同一个子网络。</p>
<p>总结一下，IP协议的作用主要有两个，一个是为每一台计算机分配IP地址，另一个是确定哪些地址在同一个子网络。</p>
<p><em><strong>ip数据包</strong></em></p>
<p>ip数据包也分为head和data部分，无须为ip包定义单独的栏位，直接放入以太网包的data部分</p>
<p>head：长度为20到60字节</p>
<p>data：最长为65,515字节。</p>
<p>而以太网数据包的”数据”部分，最长只有1500字节。因此，如果IP数据包超过了1500字节，它就需要分割成几个以太网数据包，分开发送了。</p>
<table>
<thead>
<tr>
<th>以太网头</th>
<th>ip 头</th>
<th>ip数据</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p> <em><strong>ARP协议</strong></em></p>
<p>arp协议由来：计算机通信基本靠吼，即广播的方式，所有上层的包到最后都要封装上以太网头，然后通过以太网协议发送，在谈及以太网协议时候，我门了解到</p>
<p>通信是基于mac的广播方式实现，计算机在发包时，获取自身的mac是容易的，如何获取目标主机的mac，就需要通过arp协议</p>
<p>arp协议功能：广播的方式发送数据包，获取目标主机的mac地址</p>
<p>协议工作方式：每台主机ip都是已知的</p>
<p>例如：主机172.16.10.10/24访问172.16.10.11/24</p>
<p>一：首先通过ip地址和子网掩码区分出自己所处的子网</p>
<table>
<thead>
<tr>
<th>场景</th>
<th>数据包地址</th>
</tr>
</thead>
<tbody><tr>
<td>同一子网</td>
<td>目标主机mac，目标主机ip</td>
</tr>
<tr>
<td>不同子网</td>
<td>网关mac，目标主机ip</td>
</tr>
</tbody></table>
<p>二：分析172.16.10.10/24与172.16.10.11/24处于同一网络(如果不是同一网络，那么下表中目标ip为172.16.10.1,通过arp获取的是网关的mac)</p>
<table>
<thead>
<tr>
<th></th>
<th>源mac</th>
<th>目标mac</th>
<th>源ip</th>
<th>目标ip</th>
<th>数据部分</th>
</tr>
</thead>
<tbody><tr>
<td>发送端主机</td>
<td>发送端mac</td>
<td>FF:FF:FF:FF:FF:FF</td>
<td>172.16.10.10/24</td>
<td>172.16.10.11/24</td>
<td>数据</td>
</tr>
</tbody></table>
<p>三：这个包会以广播的方式在发送端所处的自网内传输，所有主机接收后拆开包，发现目标ip为自己的，就响应，返回自己的mac</p>
<h3 id="2-3-4-传输层"><a href="#2-3-4-传输层" class="headerlink" title="2.3.4 传输层"></a>2.3.4 传输层</h3><p>传输层的由来：网络层的ip帮我们区分子网，以太网层的mac帮我们找到主机，然后大家使用的都是应用程序，你的电脑上可能同时开启qq，暴风影音，等多个应用程序，</p>
<p>那么我们通过ip和mac找到了一台特定的主机，如何标识这台主机上的应用程序，答案就是端口，端口即应用程序与网卡关联的编号。</p>
<p>传输层功能：建立端口到端口的通信</p>
<p>补充：端口范围0-65535，0-1023为系统占用端口</p>
<p>tcp协议：</p>
<p>可靠传输，TCP数据包没有长度限制，理论上可以无限长，但是为了保证网络的效率，通常TCP数据包的长度不会超过IP数据包的长度，以确保单个TCP数据包不必再分割。</p>
<table>
<thead>
<tr>
<th>以太网头</th>
<th>ip 头</th>
<th>tcp头</th>
<th>数据</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>udp协议：</p>
<p>不可靠传输，”报头”部分一共只有8个字节，总长度不超过65,535字节，正好放进一个IP数据包。</p>
<table>
<thead>
<tr>
<th>以太网头</th>
<th>ip头</th>
<th>udp头</th>
<th>数据</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>tcp报文</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008185553973-1895926477.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>tcp三次握手和四次挥手</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008185648160-191189690.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="2-3-5-应用层"><a href="#2-3-5-应用层" class="headerlink" title="2.3.5 应用层"></a>2.3.5 应用层</h3><p>应用层由来：用户使用的都是应用程序，均工作于应用层，互联网是开发的，大家都可以开发自己的应用程序，数据多种多样，必须规定好数据的组织形式 </p>
<p>应用层功能：规定应用程序的数据格式。</p>
<p>例：TCP协议可以为各种各样的程序传递数据，比如Email、WWW、FTP等等。那么，必须有不同协议规定电子邮件、网页、FTP数据的格式，这些应用程序协议就构成了”应用层”。</p>
<p> <img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161008190023098-992049015.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="2-3-6-socket"><a href="#2-3-6-socket" class="headerlink" title="2.3.6 socket"></a>2.3.6 socket</h3><p>我们知道两个进程如果需要进行通讯最基本的一个前提能能够唯一的标示一个进程，在本地进程通讯中我们可以使用PID来唯一标示一个进程，但PID只在本地唯一，网络中的两个进程PID冲突几率很大，这时候我们需要另辟它径了，我们知道IP层的ip地址可以唯一标示主机，而TCP层协议和端口号可以唯一标示主机的一个进程，这样我们可以利用ip地址＋协议＋端口号唯一标示网络中的一个进程。</p>
<p>能够唯一标示网络中的进程后，它们就可以利用socket进行通信了，什么是socket呢？我们经常把socket翻译为套接字，socket是在应用层和传输层之间的一个抽象层，它把TCP/IP层复杂的操作抽象为几个简单的接口供应用层调用已实现进程在网络中通信。</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20161013091647484-1707663286.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>socket起源于UNIX，在Unix一切皆文件哲学的思想下，socket是一种”打开—读/写—关闭”模式的实现，服务器和客户端各自维护一个”文件”，在建立连接打开后，可以向自己文件写入内容供对方读取或者读取对方内容，通讯结束时关闭文件。</p>
<h3 id="2-3-7-小结"><a href="#2-3-7-小结" class="headerlink" title="2.3.7 小结"></a>2.3.7 小结</h3><p><strong>总结图如下：</strong></p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20200415222138157-249976328.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><strong>数据传输动图如下：</strong></p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20200415220004538-1827984001.gif" srcset="/img/loading.gif" lazyload alt="img"></p>
<h1 id="三-网络通信实现"><a href="#三-网络通信实现" class="headerlink" title="三.网络通信实现"></a>三.网络通信实现</h1><p>想实现网络通信，每台主机需具备四要素</p>
<ul>
<li>本机的IP地址</li>
<li>子网掩码</li>
<li>网关的IP地址</li>
<li>DNS的IP地址</li>
</ul>
<p>获取这四要素分两种方式</p>
<p>1.静态获取</p>
<p>即手动配置</p>
<p>2.动态获取</p>
<p>通过dhcp获取</p>
<table>
<thead>
<tr>
<th>以太网头</th>
<th>ip头</th>
<th>udp头</th>
<th>dhcp数据包</th>
</tr>
</thead>
<tbody><tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<p>（1）最前面的”以太网标头”，设置发出方（本机）的MAC地址和接收方（DHCP服务器）的MAC地址。前者就是本机网卡的MAC地址，后者这时不知道，就填入一个广播地址：FF-FF-FF-FF-FF-FF。</p>
<p>（2）后面的”IP标头”，设置发出方的IP地址和接收方的IP地址。这时，对于这两者，本机都不知道。于是，发出方的IP地址就设为0.0.0.0，接收方的IP地址设为255.255.255.255。</p>
<p>（3）最后的”UDP标头”，设置发出方的端口和接收方的端口。这一部分是DHCP协议规定好的，发出方是68端口，接收方是67端口。</p>
<p>这个数据包构造完成后，就可以发出了。以太网是广播发送，同一个子网络的每台计算机都收到了这个包。因为接收方的MAC地址是FF-FF-FF-FF-FF-FF，看不出是发给谁的，所以每台收到这个包的计算机，还必须分析这个包的IP地址，才能确定是不是发给自己的。当看到发出方IP地址是0.0.0.0，接收方是255.255.255.255，于是DHCP服务器知道”这个包是发给我的”，而其他计算机就可以丢弃这个包。</p>
<p>接下来，DHCP服务器读出这个包的数据内容，分配好IP地址，发送回去一个”DHCP响应”数据包。这个响应包的结构也是类似的，以太网标头的MAC地址是双方的网卡地址，IP标头的IP地址是DHCP服务器的IP地址（发出方）和255.255.255.255（接收方），UDP标头的端口是67（发出方）和68（接收方），分配给请求端的IP地址和本网络的具体参数则包含在Data部分。</p>
<p>新加入的计算机收到这个响应包，于是就知道了自己的IP地址、子网掩码、网关地址、DNS服务器等等参数</p>
<h1 id="四-DNS域名解析"><a href="#四-DNS域名解析" class="headerlink" title="四.DNS域名解析"></a>四.DNS域名解析</h1><h3 id="4-1-dns的作用"><a href="#4-1-dns的作用" class="headerlink" title="4.1 dns的作用"></a>4.1 dns的作用</h3><p>DNS的作用：在互联网中，其实没有类似于<a target="_blank" rel="noopener" href="http://www.xxx.com/">www.xxx.com</a>这种域名方式，而替代的是以IP地址，如222.222.222.222，那我们在IE地址栏中应当输入222.222.222.222才能打开网站<a target="_blank" rel="noopener" href="http://www.xxx.com,但我们细想一下,互联网上的网站成千上万,如果每个网站登陆都需要记住一大串数字,那是不是特别不方便,对于记忆力不强的人,根本无法记住这么烦琐的数字.这个时候dns就出现了,它的作用就是将222.222.222.222解析为www.xxx.com,那么我们登陆的时候就直接输入域名就可以了./">www.xxx.com，但我们细想一下，互联网上的网站成千上万，如果每个网站登陆都需要记住一大串数字，那是不是特别不方便，对于记忆力不强的人，根本无法记住这么烦琐的数字。这个时候DNS就出现了，它的作用就是将222.222.222.222解析为www.xxx.com，那么我们登陆的时候就直接输入域名就可以了。</a></p>
<p>为什么一定要设置DNS才能上网？有些朋友可能会发现，为什么我可能登陆QQ、MSN，但却打不开网页呢？其实大部分原因都是因为DNS服务器故障造成的，DNS服务器地址是唯一的，是运营商提供给终端用户用来解析IP地址及域名的关系，而如果不设定DNS服务器地址，那么就无法查询地址的去向，自然也就打不开网页，而QQ、MSN等即时聊天软件，采用的是UDP传输协议，即不可靠传输协议，无需提供DNS服务器地址，也同样可以登陆。</p>
<h3 id="4-2-dns的两种查询方式"><a href="#4-2-dns的两种查询方式" class="headerlink" title="4.2 dns的两种查询方式"></a>4.2 dns的两种查询方式</h3><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs armasm"><span class="hljs-comment">#一 ：递归</span><br>主机向本地域名服务器的查询一般都是采用递归查询。所谓递归查询就是：如果主机所询问的本地域名服务器不知道被查询的域名的<span class="hljs-built_in">IP</span>地址，那么本地域名服务器就以DNS客户的身份，向其它根域名服务器继续发出查询请求报文(即替主机继续查询)，而不是让主机自己进行下一步查询。因此，递归查询返回的查询结果或者是所要查询的<span class="hljs-built_in">IP</span>地址，或者是报错，表示无法查询到所需的<span class="hljs-built_in">IP</span>地址。<br><br><span class="hljs-comment"># 二：迭代</span><br>本地域名服务器向根域名服务器的查询的迭代查询。迭代查询的特点：当根域名服务器收到本地域名服务器发出的迭代查询请求报文时，要么给出所要查询的<span class="hljs-built_in">IP</span>地址，要么告诉本地服务器：“你下一步应当向哪一个域名服务器进行查询”。然后让本地服务器进行后续的查询。根域名服务器通常是把自己知道的顶级域名服务器的<span class="hljs-built_in">IP</span>地址告诉本地域名服务器，让本地域名服务器再向顶级域名服务器查询。顶级域名服务器在收到本地域名服务器的查询请求后，要么给出所要查询的<span class="hljs-built_in">IP</span>地址，要么告诉本地服务器下一步应当向哪一个权限域名服务器进行查询。最后，知道了所要解析的<span class="hljs-built_in">IP</span>地址或报错，然后把这个结果返回给发起查询的主机。 <br></code></pre></td></tr></table></figure>

<p>下图给出了这两种查询的差别</p>
<p>图1</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20201012174443242-1565501096.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>图2</p>
<p> <img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20201012174541729-1246240693.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs vim">#下面举一个例子演示整个查询过程：<br><br>        假定域名为<span class="hljs-keyword">m</span>.xyz.<span class="hljs-keyword">com</span>的主机想知道另一个主机<span class="hljs-keyword">y</span>.<span class="hljs-keyword">abc</span>.<span class="hljs-keyword">com</span>的IP地址。例如，主机<span class="hljs-keyword">m</span>.xyz.<span class="hljs-keyword">com</span>打算发送邮件给<span class="hljs-keyword">y</span>.<span class="hljs-keyword">abc</span>.<span class="hljs-keyword">com</span>。这时就必须知道主机<span class="hljs-keyword">y</span>.<span class="hljs-keyword">abc</span>.<span class="hljs-keyword">com</span>的IP地址。下面是图<span class="hljs-number">2</span>的几个查询步骤：<br><br>        <span class="hljs-number">1</span>、主机<span class="hljs-keyword">m</span>.<span class="hljs-keyword">abc</span>.<span class="hljs-keyword">com</span>先向本地服务器dns.xyz.<span class="hljs-keyword">com</span>进行递归查询。<br><br>        <span class="hljs-number">2</span>、本地服务器采用迭代查询。它先向一个根域名服务器查询。<br><br>        <span class="hljs-number">3</span>、根域名服务器告诉本地服务器，下一次应查询的顶级域名服务器dns.<span class="hljs-keyword">com</span>的IP地址。<br><br>        <span class="hljs-number">4</span>、本地域名服务器向顶级域名服务器dns.<span class="hljs-keyword">com</span>进行查询。<br><br>        <span class="hljs-number">5</span>、顶级域名服务器dns.<span class="hljs-keyword">com</span>告诉本地域名服务器，下一步应查询的权限服务器dns.<span class="hljs-keyword">abc</span>.<span class="hljs-keyword">com</span>的IP地址。<br><br>        <span class="hljs-number">6</span>、本地域名服务器向权限域名服务器dns.<span class="hljs-keyword">abc</span>.<span class="hljs-keyword">com</span>进行查询。<br><br>        <span class="hljs-number">7</span>、权限域名服务器dns.<span class="hljs-keyword">abc</span>.<span class="hljs-keyword">com</span>告诉本地域名服务器，所查询的主机的IP地址。<br><br>        <span class="hljs-number">8</span>、本地域名服务器最后把查询结果告诉<span class="hljs-keyword">m</span>.xyz.<span class="hljs-keyword">com</span>。<br><br>        # 整个查询过程共用到了<span class="hljs-number">8</span>个UDP报文。<br><br>        为了提高DNS查询效率，并减轻服务器的负荷和减少因特网上的DNS查询报文数量，在域名服务器中广泛使用了高速缓存，用来存放最近查询过的域名以及从何处获得域名映射信息的记录。<br><br>        例如，在上面的查询过程中，如果在<span class="hljs-keyword">m</span>.xyz.<span class="hljs-keyword">com</span>的主机上不久前已经有用户查询过<span class="hljs-keyword">y</span>.<span class="hljs-keyword">abc</span>.<span class="hljs-keyword">com</span>的IP地址，那么本地域名服务器就不必向根域名服务器重新查询<span class="hljs-keyword">y</span>.<span class="hljs-keyword">abc</span>.<span class="hljs-keyword">com</span>的IP地址，而是直接把告诉缓存中存放的上次查询结果(即<span class="hljs-keyword">y</span>.<span class="hljs-keyword">abc</span>.<span class="hljs-keyword">com</span>的IP地址)告诉用户。<br><br>        由于名字到地址的绑定并不经常改变，为保持告诉缓存中的内容正确，域名服务器应为每项内容设置计时器并处理超过合理时间的项(例如每个项目两天)。当域名服务器已从缓存中删去某项信息后又被请求查询该项信息，就必须重新到授权管理该项的域名服务器绑定信息。当权限服务器回答一个查询请求时，在响应中都指明绑定有效存在的时间值。增加此时间值可减少网络开销，而减少此时间值可提高域名解析的正确性。<br><br>        不仅在本地域名服务器中需要高速缓存，在主机中也需要。许多主机在启动时从本地服务器下载名字和地址的全部数据库，维护存放自己最近使用的域名的高速缓存，并且只在从缓存中找不到名字时才使用域名服务器。维护本地域名服务器数据库的主机应当定期地检查域名服务器以获取新的映射信息，而且主机必须从缓存中删除无效的项。由于域名改动并不频繁，大多数网点不需花精力就能维护数据库的一致性。<br></code></pre></td></tr></table></figure>

<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20201012174943786-1550814066.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="4-3-DNS解析流程举例"><a href="#4-3-DNS解析流程举例" class="headerlink" title="4.3 DNS解析流程举例"></a>4.3 DNS解析流程举例</h3><p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20201012175307563-473595213.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs awk">如上图所示，我们将详细阐述DNS解析流程。<br><br><span class="hljs-number">1</span>、首先客户端位置是一台电脑或手机，在打开浏览器以后，比如输入http:<span class="hljs-regexp">//</span>www.zdns.cn的域名，它首先是由浏览器发起一个DNS解析请求，如果本地缓存服务器中找不到结果，则首先会向根服务器查询，根服务器里面记录的都是各个顶级域所在的服务器的位置，当向根请求http:<span class="hljs-regexp">//</span>www.zdns.cn的时候，根服务器就会返回.cn服务器的位置信息。<br><br><span class="hljs-number">2</span>、递归服务器拿到.cn的权威服务器地址以后，就会寻问cn的权威服务器，知不知道http:<span class="hljs-regexp">//</span>www.zdns.cn的位置。这个时候cn权威服务器查找并返回http:<span class="hljs-regexp">//</span>zdns.cn服务器的地址。<br><br><span class="hljs-number">3</span>、继续向http:<span class="hljs-regexp">//</span>zdns.cn的权威服务器去查询这个地址，由http:<span class="hljs-regexp">//</span>zdns.cn的服务器给出了地址：<span class="hljs-number">202.173</span>.<span class="hljs-number">11.10</span><br><br><span class="hljs-number">4</span>、最终才能进行http的链接，顺利访问网站。<br><br><span class="hljs-number">5</span>、这里补充说明，一旦递归服务器拿到解析记录以后，就会在本地进行缓存，如果下次客户端再请求本地的递归域名服务器相同域名的时候，就不会再这样一层一层查了，因为本地服务器里面已经有缓存了，这个时候就直接把http:<span class="hljs-regexp">//</span>www.zdns.cn的A记录返回给客户端就可以了。<br></code></pre></td></tr></table></figure>

<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/ContractedBlock.gif" srcset="/img/loading.gif" lazyload alt="img"> 了解：DNS查询类型</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/ContractedBlock.gif" srcset="/img/loading.gif" lazyload alt="img"> 了解：DNS资源记录</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20201012175158975-374415105.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="4-4-DNS缓存"><a href="#4-4-DNS缓存" class="headerlink" title="4.4 DNS缓存"></a>4.4 DNS缓存</h3><p>DNS缓存指DNS返回了正确的IP之后，系统就会将这个结果临时储存起来。并且它会为缓存设定一个失效时间 (例如N小时)，在这N小时之内，当你再次访问这个网站时，系统就会直接从你电脑本地的DNS缓存中把结果交还给你，而不必再去询问DNS服务器，变相“加速”了网址的解析。</p>
<p>当然，在超过N小时之后，系统会自动再次去询问DNS服务器获得新的结果。所以，当你修改了 DNS 服务器，并且不希望电脑继续使用之前的DNS缓存时，就需要手动去清除本地的缓存了。</p>
<h3 id="4-5-DNS缓存分类"><a href="#4-5-DNS缓存分类" class="headerlink" title="4.5 DNS缓存分类"></a>4.5 DNS缓存分类</h3><figure class="highlight ldif"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs ldif"><span class="hljs-attribute">1）浏览器DNS缓存（内存中)</span>: 浏览器会按照一定频率缓存DNS记录<br><br><span class="hljs-attribute">2）本地操作系统DNS缓存(内存中)</span>: 如果浏览器缓存中找不到需要的DNS记录，那就去操作系统找。<br><br><span class="hljs-attribute">3）本地HOSTS文件（硬盘中）</span>: Windows系统中位于C:\Windows\System32\drivers\etc<br><br><span class="hljs-attribute">4）路由器指定的DNS(远程)</span>: 路由器自动获取DNS地址，也可以手动修改-登录后台设置DNS服务器地址<br>　　ps：路由器DNS被篡改会造成域名劫持，你访问的网址都会被定位到同一个位置，但是IP直接可以访问<br><br><span class="hljs-attribute">5）ISP的DNS服务器（远程）</span>:  ISP(Internet Service Provider互联网服务提供商、联通电信移动)，ISP有专门的DNS服务器应 对DNS查询请求 6）根服务器（远程，跨国）: ISP的DNS服务器还找不到的话，它就会向根服务器发出查询请求<br></code></pre></td></tr></table></figure>



<p>调用系统缓存需要跨进程，消耗大，因此为了解析速度的方便，就有了一系列缓存来加快IP查找速度。 </p>
<h3 id="4-6-浏览器DNS查找顺序"><a href="#4-6-浏览器DNS查找顺序" class="headerlink" title="4.6 浏览器DNS查找顺序"></a>4.6 浏览器DNS查找顺序</h3><p><strong>浏览器DNS缓存-&gt;本地系统DNS缓存-&gt;本地计算机HOSTS文件-&gt;ISP DNS缓存-&gt;递归or迭代搜索</strong></p>
<p>期间如果查询到了，也就直接访问ip地址了，这个就像三级缓存原理一样，例如，能够在hosts文件中找到就不会再去查其他的</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/1036857-20201012181341361-436742942.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<h3 id="4-7-清除DNS缓存"><a href="#4-7-清除DNS缓存" class="headerlink" title="4.7 清除DNS缓存"></a>4.7 清除DNS缓存</h3><p>打开cmd执行命令：ipconfig /all</p>
<figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs dns">全国通用DNS地址（国内用户推荐使用，速度较快！）<br>首先DNS服务器地址添：<span class="hljs-number">114.114.114.114</span>  (位于北京人民英雄纪念碑）<br>备用DNS服务器地址添：<span class="hljs-number">114.114.115.115</span><br>全球通用DNS地址（此DNS地址为谷歌服务器的）<br>首选DNS服务器地址添：<span class="hljs-number">8.8.8.8</span><br>备用DNS服务器地址添：<span class="hljs-number">8.8.4.4</span><br></code></pre></td></tr></table></figure>

<p>查看本地dns缓存命令：ipconfig /displaydns</p>
<p>清除本地dns缓存命令：ipconfig /flushdns</p>
<p>清除浏览器缓存：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs awk">我们在开发的时候，有时候会给某个域名绑hosts，用于本地开发测试，但是绑了之后，用谷歌浏览器访问会发现并没有生效，按F12会发现访问的还是线上的ip，说明浏览器是有该域名的dns缓存的，那么如何清除浏览器的dns缓存呢？<br><br><span class="hljs-comment"># 1、针对谷歌浏览器</span><br>谷歌浏览器清除方法如下：打开浏览器，访问如下地址<br>chrome:<span class="hljs-regexp">//</span>net-internals/<span class="hljs-comment">#dns</span><br><br>点击 clear host cache，就清楚了浏览器的dns缓存，再访问绑hosts的域名，就会发现ip变啦<br><br><span class="hljs-comment"># 2、针对火狐浏览器</span><br>如果是firefox火狐浏览器的话，可以按照以下方式：<br><br>在地址栏中 about:config 并回车，可能会出现一个警告信息，直接点击按钮进入，会出现firefox的所有配置信息，通过搜索dns 进行过滤，可以看到一项名为 network.dnsCacheExpirationGracePeriod 项，它对应的值就是DNS缓存的时间，双击此项，会出现修改的提示框，填入 <span class="hljs-number">0</span> （不缓存DNS）即可。<br></code></pre></td></tr></table></figure>



<h3 id="4-8-其他了解"><a href="#4-8-其他了解" class="headerlink" title="4.8 其他了解"></a>4.8 其他了解</h3><p>13台根dns：</p>
<p>A.root-servers.net198.41.0.4美国<br>B.root-servers.net192.228.79.201美国（另支持<a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=IPv6&tn=44039180_cpr&fenlei=mv6quAkxTZn0IZRqIHckPjm4nH00T1d9ryR4nhnsn1b3ujfYPAfk0ZwV5Hcvrjm3rH6sPfKWUMw85HfYnjn4nH6sgvPsT6KdThsqpZwYTjCEQLGCpyw9Uz4Bmy-bIi4WUvYETgN-TLwGUv3ErH0YPW6snH0">IPv6</a>）<br>C.root-servers.net192.33.4.12法国<br>D.root-servers.net128.8.10.90美国<br>E.root-servers.net192.203.230.10美国<br>F.root-servers.net192.5.5.241美国（另支持<a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=IPv6&tn=44039180_cpr&fenlei=mv6quAkxTZn0IZRqIHckPjm4nH00T1d9ryR4nhnsn1b3ujfYPAfk0ZwV5Hcvrjm3rH6sPfKWUMw85HfYnjn4nH6sgvPsT6KdThsqpZwYTjCEQLGCpyw9Uz4Bmy-bIi4WUvYETgN-TLwGUv3ErH0YPW6snH0">IPv6</a>）<br>G.root-servers.net192.112.36.4美国<br>H.root-servers.net128.63.2.53美国（另支持<a target="_blank" rel="noopener" href="https://www.baidu.com/s?wd=IPv6&tn=44039180_cpr&fenlei=mv6quAkxTZn0IZRqIHckPjm4nH00T1d9ryR4nhnsn1b3ujfYPAfk0ZwV5Hcvrjm3rH6sPfKWUMw85HfYnjn4nH6sgvPsT6KdThsqpZwYTjCEQLGCpyw9Uz4Bmy-bIi4WUvYETgN-TLwGUv3ErH0YPW6snH0">IPv6</a>）<br>I.root-servers.net192.36.148.17瑞典<br>J.root-servers.net192.58.128.30美国<br>K.root-servers.net193.0.14.129英国（另支持IPv6）<br>L.root-servers.net198.32.64.12美国<br>M.root-servers.net202.12.27.33日本（另支持IPv6）</p>
<p>域名定义：<a target="_blank" rel="noopener" href="http://jingyan.baidu.com/article/1974b289a649daf4b1f774cb.html">http://jingyan.baidu.com/article/1974b289a649daf4b1f774cb.html</a></p>
<p>顶级域名：以.com,.net,.org,.cn等等属于国际顶级域名，根据目前的国际互联网域名体系，国际顶级域名分为两类：类别顶级域名(gTLD)和地理顶级域名(ccTLD)两种。类别顶级域名是　　　　　　　　       以”COM”、”NET”、”ORG”、”BIZ”、”INFO”等结尾的域名，均由国外公司负责管理。地理顶级域名是以国家或地区代码为结尾的域名，如”CN”代表中国，”UK”代表英国。地理顶级域名一般由各个国家或地区负责管理。</p>
<p>二级域名：二级域名是以顶级域名为基础的地理域名，比喻中国的二级域有，.com.cn,.net.cn,.org.cn,.gd.cn等.子域名是其父域名的子域名，比喻父域名是abc.com,子域名就是<a target="_blank" rel="noopener" href="http://www.abc.com或者*.abc.com/">www.abc.com或者*.abc.com</a>.<br>一般来说，二级域名是域名的一条记录，比如alidiedie.com是一个域名，<a target="_blank" rel="noopener" href="http://www.alidiedie.com是其中比较常用的记录,一般默认是用这个,但是类似*.alidiedie.com的域名全部称作是alidiedie.com的二级/">www.alidiedie.com是其中比较常用的记录，一般默认是用这个，但是类似*.alidiedie.com的域名全部称作是alidiedie.com的二级</a></p>
<h1 id="五-网络通信流程"><a href="#五-网络通信流程" class="headerlink" title="五 网络通信流程"></a>五 网络通信流程</h1><p>1.本机获取</p>
<ul>
<li>本机的IP地址：192.168.1.100</li>
<li>子网掩码：255.255.255.0</li>
<li>网关的IP地址：192.168.1.1</li>
<li>DNS的IP地址：8.8.8.8</li>
</ul>
<p>2.打开浏览器，想要访问Google，在地址栏输入了网址：<a target="_blank" rel="noopener" href="http://www.google.com./">www.google.com。</a></p>
<p>3.dns协议(基于udp协议)</p>
<p>4.HTTP部分的内容，类似于下面这样：</p>
<blockquote>
<p>GET / HTTP/1.1<br>Host: <a target="_blank" rel="noopener" href="http://www.google.com/">www.google.com</a><br>Connection: keep-alive<br>User-Agent: Mozilla/5.0 (Windows NT 6.1) ……<br>Accept: text/html,application/xhtml+xml,application/xml;q=0.9,<em>/</em>;q=0.8<br>Accept-Encoding: gzip,deflate,sdch<br>Accept-Language: zh-CN,zh;q=0.8<br>Accept-Charset: GBK,utf-8;q=0.7,*;q=0.3<br>Cookie: … …</p>
</blockquote>
<p>我们假定这个部分的长度为4960字节，它会被嵌在TCP数据包之中。</p>
<p>5 TCP协议</p>
<p>TCP数据包需要设置端口，接收方（Google）的HTTP端口默认是80，发送方（本机）的端口是一个随机生成的1024-65535之间的整数，假定为51775。</p>
<p>TCP数据包的标头长度为20字节，加上嵌入HTTP的数据包，总长度变为4980字节。</p>
<p>6 IP协议</p>
<p>然后，TCP数据包再嵌入IP数据包。IP数据包需要设置双方的IP地址，这是已知的，发送方是192.168.1.100（本机），接收方是172.194.72.105（Google）。</p>
<p>IP数据包的标头长度为20字节，加上嵌入的TCP数据包，总长度变为5000字节。</p>
<p>7 以太网协议</p>
<p>最后，IP数据包嵌入以太网数据包。以太网数据包需要设置双方的MAC地址，发送方为本机的网卡MAC地址，接收方为网关192.168.1.1的MAC地址（通过ARP协议得到）。</p>
<p>以太网数据包的数据部分，最大长度为1500字节，而现在的IP数据包长度为5000字节。因此，IP数据包必须分割成四个包。因为每个包都有自己的IP标头（20字节），所以四个包的IP数据包的长度分别为1500、1500、1500、560。</p>
<p><img src="https://yinshiweiysw.github.io/images/assets.%E6%9C%AA%E5%91%BD%E5%90%8D/640.jpeg" srcset="/img/loading.gif" lazyload alt="img"></p>
<p>8 服务器端响应</p>
<p>经过多个网关的转发，Google的服务器172.194.72.105，收到了这四个以太网数据包。</p>
<p>根据IP标头的序号，Google将四个包拼起来，取出完整的TCP数据包，然后读出里面的”HTTP请求”，接着做出”HTTP响应”，再用TCP协议发回来。</p>
<p>本机收到HTTP响应以后，就可以将网页显示出来，完成一次网络通信。</p>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/hexoblog%E6%B7%BB%E5%8A%A0hexo%E6%A0%87%E7%AD%BE/">hexoblog添加hexo标签</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/python/">python</a>
                    
                      <a class="hover-with-bg" href="/tags/python%E4%BB%A3%E7%A0%81/">python代码</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">
                  
                    本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！
                  
                </p>
              
              
                <div class="post-prevnext">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2021/11/01/python%E5%BC%82%E5%B8%B8_hexo/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">python异常</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2021/10/29/hexo_blog%E6%B7%BB%E5%8A%A0%E6%A0%87%E7%AD%BE_hexo/">
                        <span class="hidden-mobile">hexoblog添加hexo标签</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;TOC</p>
  <div class="toc-body" id="toc-body"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
    

    
  </main>

  <footer class="text-center mt-5 py-3">
  <div class="footer-content">
     <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
  </div>
  

  

  
</footer>


  <!-- SCRIPTS -->
  
  <script  src="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.jsdelivr.net/npm/nprogress@0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js" ></script>
<script  src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>

<!-- Plugins -->


  <script  src="/js/local-search.js" ></script>



  
    <script  src="/js/img-lazyload.js" ></script>
  



  



  
    <script  src="https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@3/dist/jquery.fancybox.min.js" ></script>
  
  
    <script  src="https://cdn.jsdelivr.net/npm/anchor-js@4/anchor.min.js" ></script>
  
  
    <script defer src="https://cdn.jsdelivr.net/npm/clipboard@2/dist/clipboard.min.js" ></script>
  






  <script  src="https://cdn.jsdelivr.net/npm/typed.js@2/lib/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var title = document.getElementById('subtitle').title;
      
        typing(title);
      
    })(window, document);
  </script>















<!-- 主题的启动项 保持在最底部 -->
<script  src="/js/boot.js" ></script>


</body>
</html>
